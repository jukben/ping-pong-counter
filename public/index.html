<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ping Pong Score Counter</title>
    <style>
      body {
        padding: 0;
        margin: 0;
        font-family: Arial, sans-serif;
      }

      .score-container {
        display: flex;
        height: 100vh;
        justify-content: space-between;
        align-items: center;
      }

      .score-box {
        flex: 1;
        height: 100%;
        text-align: center;
        font-size: 22rem;
        display: flex;
        justify-content: center;
        align-items: center;
        position: relative;
      }

      .score-box span {
        z-index: 1;
      }

      .green {
        background-color: #a1eebd;
      }

      .blue {
        background-color: #7bd3ea;
      }

      .serving::before,
      .won::after {
        content: "";
        position: absolute;
        opacity: 0.3;
        top: 0;
        background-size: initial;
        width: 100%;
        height: 100%;
      }

      .serving::before {
        background-image: url("table_tennis_paddle_and_ball.png");
      }

      .won::after {
        background-image: url("crown.png");
      }

      .events-log {
        position: absolute;
        left: 0;
        top: 0;
        font-size: 2rem;
      }

      .events-log ul {
        list-style: none;
        padding: 0;
        margin: 0;
        background: rgba(0, 0, 0, 0.2);
        padding: 10px;
      }

      .events-log li {
        padding-top: 3px;
        padding-bottom: 3px;
      }

      .events-log span {
        padding-left: 2px;
        padding-right: 2px;
        display: inline-block;
      }

      .paused {
        position: absolute;
        height: 100%;
        width: 100%;
        font-size: 8rem;
        background: white;
        z-index: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
      }

      .paused.hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="score-container" id="game">
      <div class="score-box green" id="player1"><span>0</span></div>
      <div class="score-box blue" id="player2"><span>0</span></div>
      <div class="events-log" id="events"></div>
      <div class="paused hidden" id="paused">Waiting for controllers...</div>
    </div>

    <script type="module">
      import { io } from "https://cdn.socket.io/4.7.3/socket.io.esm.min.js";

      const socket = io.connect("http://localhost:3000");

      socket.on("gameRestart", () => {
        document.getElementById("player1").classList.remove("serving");
        document.getElementById("player2").classList.remove("serving");
        document.getElementById("player1").classList.remove("won");
        document.getElementById("player2").classList.remove("won");

        document.getElementById("player1").innerHTML = `<span>0</span>`;
        document.getElementById("player2").innerHTML = `<span>0</span>`;
        document.getElementById("events").innerHTML = "";
      });

      socket.on("state", (state) => {
        console.log("state", state);

        if (state.gamePaused) {
          document.getElementById("paused").classList.remove("hidden");
        } else {
          document.getElementById("paused").classList.add("hidden");
        }

        if (state.serving === "player2") {
          document.getElementById("player1").classList.remove("serving");
          document.getElementById("player2").classList.add("serving");
        } else {
          document.getElementById("player2").classList.remove("serving");
          document.getElementById("player1").classList.add("serving");
        }

        document.getElementById("player1").innerHTML =
          `<span>${state.player1}</span>`;
        document.getElementById("player2").innerHTML =
          `<span>${state.player2}</span>`;

        if (state.gameOver) {
          document.getElementById(state.winner).classList.add("won");
          document.getElementById("player1").classList.remove("serving");
          document.getElementById("player2").classList.remove("serving");
        }

        if (state.events.length > 0) {
          document.getElementById("events").innerHTML = `<ul>${state.events
            .map((event) => {
              const color = event.player === "player1" ? "green" : "blue";
              const name = event.player === "player1" ? "Green" : "Blue";

              if (event.type === "score") {
                return `<li><span class="${color}">${name}</span> has scored!</li>`;
              } else if (event.type === "gameOver") {
                return `<li><span class="${color}"><strong>${name}</strong></span> has won the game!</li>`;
              }
            })
            .reverse()
            .join("")}</ul>`;
        }
      });

      socket.on("servingChange", (serving) => {
        console.log("servingChange", serving);
      });

      socket.on("disconnect", () => {
        console.log("Disconnected from the server");
      });
    </script>
  </body>
</html>
